/******* tools.js Begin  *******/

var __srvUrl='http://test.donglele.com/api/';

var xhr={
	get: function (url, data, fn){
		var obj=new XMLHttpRequest();  
		obj.open('GET', __srvUrl+url+'?'+this.format(data),true);
		obj.onreadystatechange=function(){
			if (obj.readyState == 4 && obj.status == 200 || obj.status == 304) {
				fn.call(this, JSON.parse(obj.responseText));
			}
		};
		obj.send(null);
	},
	post: function (url, data, fn) {
		var obj = new XMLHttpRequest();
		obj.open("POST", __srvUrl+url, true);
		obj.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
		obj.onreadystatechange = function () {
			if (obj.readyState == 4 && (obj.status == 200 || obj.status == 304)) {
				fn.call(this, JSON.parse(obj.responseText));
			}
		};
		obj.send(this.format(data));
	},
	format:function(data){
		var arr = [];
		for (var i in data) {
			arr.push(encodeURIComponent(i) + "=" + encodeURIComponent(data[i]));
		}
		arr.push(("v=" + Math.random()));
		return arr.join("&");
	}
};
/*获取url值*/
function getups(n){
	var url=n||location.search,i=0; url=url.indexOf("?")>-1?url.substring(1).replace(/\?/g,"&").split("&"):"";
	var ups={},lg=url.length,p;
	for(;i<lg;i++){ p=url[i].split("="); ups[p[0]]=decodeURIComponent(p[1]); };
	return ups;
}
var local={
	get:function(name){
		var o=localStorage.getItem(name)||"";
		if( (o==="") || (o.indexOf("{")<0) && (o.indexOf("[")<0) ){ return o; }else{ return JSON.parse(o); }
	},
	set:function(name,val){
		val=typeof(val)==="object"?JSON.stringify(val):val; localStorage.setItem(name,val);
	},
	clear:function(name){
		localStorage.removeItem(name);
	}
};
function _loadInfo(){
	return local.get("loadInfo");
}
/*token*/
function _token(){
	return _loadInfo().token||"";
}
function returns(r){
	if(r.result){
		return r
	}else{
		if(r.resultcode==='NotLogin'){
			location.href="login.html"
		}else{
			alert(r.resultstring)
		}
	}
}

/******* tools.js by-TEEMO End *******/